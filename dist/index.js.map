{"version":3,"file":"index.js","sources":["../src/constant.ts","../src/utils/index.ts","../src/utils/combine-component-cache.ts","../src/utils/post.ts","../src/utils/pre.ts","../src/index.ts"],"sourcesContent":["/**\n * @Author: maxizhang\n * @Date: 2022-01-10 11:46:06\n * @FilePath: /vite-plugin-uniapp-generic/src/constant.ts\n * @Description:\n */\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const GENERIC_SLOT_KEY = 'generic';\nexport const GENERIC_COMBINE_KEY = 'generic:';\nexport const TEST_IS_PURE_VUE = /.\\.vue$/i;\nexport const TEST_IS_COMBINE_GENERIC = /generic:[A-Za-z0-9]+$/; // 匹配 generic:xxx\nexport const TEST_IS_FATHER_GENERIC = /^generic$/; // 匹配 generic\nexport const SPEC_COMP_ID_KEY = 'u-i';\nexport const COMP_ID_COMB_TEMP_SON = `generic-comb-temp-cid-${uuidv4()}`;  // 组合组件里新增临时的子component标识\nexport const COMP_PRE_COMB_FATHERCOMP = 'generic-comb-temp-fid-'; // 组合组件里新增临时的子component标识\nexport const COMP_ID_FATHER_GENERICCOMP = `generic-father-temp-gid-${uuidv4()}`; // 父组件里笔记插入genric组件的id\nexport const MID_PROPS_REG_STR = '[A-Za-z0-9\\\\s:\\\\-_={}.\"]'; // 数字、字母。空格、-、_、=、{、}、.\"\n\nexport const TEMPLATE_EXTNAME = {\n    'mp-weixin': '.wxml',\n    'mp-qq': '.qml',\n    'mp-baidu':'.swan',\n    'mp-kuaishou': '.ksml',\n}\n\n// ksml ttml\n","/**\n * @Author:\n * @Date: 2022-01-10 11:46:30\n * @FilePath: /github-vite-plugin-uniapp-generics/src/utils/index.ts\n * @Description:\n */\nimport { v4 as uuidv4 } from 'uuid';\nimport {PropsFilter} from '../types'\n\nimport {\n    GENERIC_COMBINE_KEY,\n    SPEC_COMP_ID_KEY,\n    COMP_ID_COMB_TEMP_SON,\n    COMP_PRE_COMB_FATHERCOMP,\n    COMP_ID_FATHER_GENERICCOMP,\n    MID_PROPS_REG_STR,\n    TEMPLATE_EXTNAME\n} from '../constant';\n\nexport function getCombineGenericKey(key: string): string {\n    // 组合：<ceshiGenetic generic:child=\"ceshiGeneticCom\">\n    return key.replace(GENERIC_COMBINE_KEY, '');\n}\n\n// 生成并返回uuid里的名字\nexport function getCombineFatherUUID(): string {\n    return COMP_PRE_COMB_FATHERCOMP + uuidv4();\n}\n// 基本的结构中过滤出template的ast，减少后面的渲染次数\nexport function getTemplateFromBaseAst(ast) {\n    if (ast?.children.length) {\n        const resMap = ast.children.filter((node) => node.tag === 'template');\n        return resMap[0];\n    }\n    return null;\n}\n\nexport function getCombineChildTempComp(componentChildName: string): string {\n    return `<${componentChildName} ${SPEC_COMP_ID_KEY}=\"${COMP_ID_COMB_TEMP_SON}\" />`;\n}\n\nexport function getTemplateExtnameReg(platform: string): RegExp {\n    const reg = new RegExp(\n        `(${TEMPLATE_EXTNAME[platform]})$`,\n        \"i\"\n    );\n    return reg;\n}\n\nexport function getCombineChildReg(): RegExp {\n    const reg = new RegExp(\n        `<[A-Za-z0-9\\\\s:\\\\-_=]+\"${COMP_ID_COMB_TEMP_SON}\"${MID_PROPS_REG_STR}*/>`\n    , 'g');\n    return reg;\n}\nexport function getFatherGenericComReg(str: string, opts: string) : RegExp {\n    const reg = new RegExp(\n        `<([a-z0-9A-Z\\\\-_]+)\\\\s${MID_PROPS_REG_STR}*(${str})`,\n        opts\n    );\n    return reg;\n}\n\nexport function getCombineFatherUnqpropStr(fatherCompID: string) {\n    return `${SPEC_COMP_ID_KEY}=\"${fatherCompID}\"`;\n}\n\nexport function getFatherGeneticPropStr(): string {\n    return `${SPEC_COMP_ID_KEY}=\"${COMP_ID_FATHER_GENERICCOMP}\"`;\n}\n\nexport function getGenericNodeBypRrops(node, filter: PropsFilter): void {\n    if (node.props?.length) {\n        const targetProps: Object[] = [];\n        const { rule, cb } = filter;\n        node.props.forEach((prop) => {\n            const match = rule.exec(prop.name);\n            if (match) {\n                targetProps.push({ prop, match });\n            }\n        });\n        if (targetProps.length) {\n            cb({ node, targetProps });\n        }\n    }\n    if (node.children?.length) {\n        node.children.forEach((childNode) => {\n            childNode && getGenericNodeBypRrops(childNode, filter);\n        });\n    }\n}\n\n// 驼峰转成中划线分割\nexport function formatComponentName(name: string): string {\n    return name\n        .replace(/([A-Z])/g, '-$1')\n        .toLowerCase()\n        .replace(/^-/, '');\n}\n","/**\n * @Author: maxizhang\n * @Date: 2022-01-10 16:44:48\n * @FilePath: /vite-plugin-uniapp-generics/src/utils/combine-component-cache.ts\n * @Description: \n */\n\nimport {formatComponentName} from './index'\n\nlet CACHE_GENERIC_COMBINE = {};\n\nexport function addCombineCache(fatherCompID: string, { fullFilePath, fatherCompName, genericInfos }) {\n   const formatName = formatComponentName(fatherCompName);\n   genericInfos.forEach((info) => {\n     const { sonCompName, genericKey } = info;\n     info.formatSonCompName = formatComponentName(sonCompName);\n     info.formatGenricKey = formatComponentName(genericKey);\n   });\n \n   CACHE_GENERIC_COMBINE[fatherCompID] = {\n     fullFilePath, name: fatherCompName, formatName, genericInfos,\n   };\n }\n \nexport function clearCombineCache() {\n   CACHE_GENERIC_COMBINE = {};\n}\n\nexport function getCombineCache(){\n    return CACHE_GENERIC_COMBINE\n}\n ","/**\n * @Author: maxizhang\n * @Date: 2022-01-17 16:16:30\n * @FilePath: /github-vite-plugin-uniapp-generics/src/utils/post.ts\n * @Description: \n */\n\nimport {WxComponentFileJson} from './../types'\nimport {\n    GENERIC_COMBINE_KEY,\n    TEMPLATE_EXTNAME,\n} from './../constant';\n\nimport {\n    getCombineChildReg,\n    getFatherGenericComReg,\n    getCombineFatherUnqpropStr,\n    getFatherGeneticPropStr,\n    getTemplateExtnameReg\n} from './index';\n\nimport {\n    getCombineCache,\n} from './combine-component-cache';\n\nconst CACHE_BUNDLE = {};\n // 给父json文件添加 componentGenerics依赖，并且重新生成json文件 \nfunction updateFatherJson({jsonFileName, bundle, arrGenricRes, ctx}){\n    let jsonObj: WxComponentFileJson = {};\n    const jsonChunkInfo = bundle[jsonFileName];\n    if (jsonChunkInfo) {\n        jsonObj = JSON.parse(jsonChunkInfo?.source);\n    } else {\n        // 热更新的时候，可能没有 jsonChunkInfo 的信息，因此要读取上一次的缓存数据处理\n        jsonObj = JSON.parse(\n            CACHE_BUNDLE[jsonFileName]\n        );\n    }\n    if (!jsonObj.componentGenerics) {\n        jsonObj.componentGenerics = {};\n    }\n    arrGenricRes.forEach((res) => {\n        const genericKey: string = res[1];\n        // 热更新的时候 json文件里的 componentGenerics会存在老的数据，一键直接清componentGenerics可能会有其他隐患，暂时先不处理\n        jsonObj.componentGenerics[genericKey] = true;\n    });\n\n    const jsonStr = JSON.stringify(jsonObj, null, 2);\n    CACHE_BUNDLE[jsonFileName] = jsonStr; // 更新缓存\n    if (jsonChunkInfo) {\n        jsonChunkInfo.source = jsonStr;\n    } else {\n        // 无jsonChunkInfo的时候，需要重新创建json文件\n        ctx.emitFile({\n            fileName: jsonFileName,\n            type: 'asset',\n            source: jsonStr,\n        });\n    }\n}\n \n\nexport function cleanComponent(ctx, bundle, platform){\n    const CACHE_GENERIC_COMBINE = getCombineCache();\n    const fatherGenericPropStr = getFatherGeneticPropStr();\n    const extName = TEMPLATE_EXTNAME[platform];\n    Object.keys(bundle).forEach((fileName) => {\n        const chunkInfo = bundle[fileName];\n        // console.log('chunkInfo', chunkInfo);\n        // console.log('fileName', fileName);\n        if (getTemplateExtnameReg(platform).test(fileName)) {\n            // 处理组合组件\n            Object.keys(CACHE_GENERIC_COMBINE).forEach((unqid) => {\n                if (chunkInfo.source.indexOf(unqid) !== -1) {\n                    // 通过 unqid 匹配\n                    const cacheObj = CACHE_GENERIC_COMBINE[unqid];\n                    // 去掉组合组件中新增的临时节点\n                    const reg = getCombineChildReg();\n                    const res = chunkInfo.source.match(reg);\n                    res.forEach( element => {\n                        chunkInfo.source = chunkInfo.source.replace(element, '');\n                    });\n                    \n                    // 去掉组合组件里父节点的unqid，并且增加 generic:child=\"ceshiGeneticCom\" ，切 ceshiGeneticCom 要从驼峰转成中划线\n                    const fatherGenericSym = cacheObj.genericInfos\n                        .map(\n                            (info) => `${GENERIC_COMBINE_KEY}${info.formatGenricKey}=\"${info.formatSonCompName}\"`\n                        )\n                        .join(' ');\n                    chunkInfo.source = chunkInfo.source.replace(\n                        getCombineFatherUnqpropStr(unqid),\n                        fatherGenericSym\n                    );\n                }\n            });\n            \n            if ( chunkInfo.source.indexOf(fatherGenericPropStr) !== -1) {\n                // 处理父组件里的generic组件\n                //  <mmGeneric generic u-i=\"com-generic-id\"  /> => <mmGeneric  />\n                const reg = getFatherGenericComReg(fatherGenericPropStr,'g');\n                const arrGenricRes:Array<Array<string>> = [\n                    ...chunkInfo.source.matchAll(reg),\n                ];\n                \n                // 去掉临时记录的generic key\n                chunkInfo.source = chunkInfo.source.replace(new RegExp(fatherGenericPropStr, 'g'),'');\n                const jsonFileName = fileName.replace(extName,'.json');\n                \n                // 找到father的json文件，新增generic的依赖\n                updateFatherJson({jsonFileName, bundle, arrGenricRes, ctx})\n            }\n        }\n    });\n}","/**\n * @Author: maxizhang\n * @Date: 2022-01-17 16:15:25\n * @FilePath: /vite-plugin-uniapp-generics/src/utils/pre.ts\n * @Description: \n */\nimport {\n    TEST_IS_COMBINE_GENERIC,\n    TEST_IS_FATHER_GENERIC,\n} from './../constant';\n\nimport {\n    getCombineGenericKey,\n    getCombineFatherUUID,\n    getCombineChildTempComp,\n    getCombineFatherUnqpropStr,\n    getFatherGeneticPropStr,\n    getGenericNodeBypRrops,\n} from './index';\n\nimport {\n    addCombineCache,\n} from './combine-component-cache';\n\n\n// 父: <child generic :index=\"index\" :name=\"'maxi'+val\" />\nexport function rewriteFcompGenericSym(templateAst, codeObj){\n    getGenericNodeBypRrops(templateAst, {\n        rule: TEST_IS_FATHER_GENERIC,\n        cb: ({ targetProps }) => {\n            // 转换 generic => uniapp中白名单的props，防止编译过程中被uniapp转换\n            const propSymidStr = getFatherGeneticPropStr();\n            const targetProp = targetProps[0];  // 只需匹配首个就好，重复key无需理会\n            codeObj.overwrite(\n                targetProp.prop.loc.start.offset,\n                targetProp.prop.loc.end.offset,\n                propSymidStr\n            );\n        },\n    });\n}\n\n// 组合：<ceshiGenetic generic:child=\"ceshiGeneticCom\">\nexport function rewriteCcompGeneric(id, templateAst, codeObj) {\n    getGenericNodeBypRrops(templateAst, {\n        rule: TEST_IS_COMBINE_GENERIC,\n        cb: ({ node, targetProps }) => {\n            // console.log('maxi transform id', id);\n            const fatherCompID = getCombineFatherUUID();\n            const genericInfos: Object[] = [];  // 记录调用父node中的genric key和对应component入参\n            \n            // 处理一个node中的所有generic props\n            targetProps.forEach((targetProp) => {\n                // 获取generic:key=\"componentName\"中的 key\n                const genericKey = getCombineGenericKey(targetProp.prop.name); \n                // 获取generic:key=\"componentName\"中的 componentName\n                const componentChildName = targetProp.prop.value.content;\n                // 记录引用关系，\n                genericInfos.push({\n                    genericKey,\n                    sonCompName: componentChildName,\n                });\n                // 因为genric:\"compoentName\"这种方式所引用的组件并不会被认可为实际引用（如果其他文件也没用到这个引用的组件 此组件不会生成编译出对应的wxcomponent文件），所以通过实际创建真实compoents的方式去处理。\n                // 并且此临时创建的文件会被删除\n                const endChild = templateAst.children.length - 1;\n                codeObj.appendRight(\n                    templateAst.children[endChild].loc.end.offset,\n                    getCombineChildTempComp(componentChildName)\n                );\n            });\n\n            // 给父组件添加唯一id\n            codeObj.appendRight(\n                node.loc.start.offset + node.tag.length + 2,\n                `${getCombineFatherUnqpropStr(fatherCompID)} `\n            );\n\n            // 用父组件唯一id为key，记录其props入参等\n            addCombineCache(fatherCompID, {\n                fullFilePath: id,\n                fatherCompName: node.tag,\n                genericInfos,\n            });\n\n        },\n    });\n}","import { parseVue } from '@dcloudio/uni-cli-shared';\nimport MagicString from 'magic-string';\nimport {cleanComponent} from './utils/post'\nimport {rewriteFcompGenericSym, rewriteCcompGeneric} from './utils/pre'\nimport {\n    GENERIC_SLOT_KEY,\n    TEST_IS_PURE_VUE,\n} from './constant';\n\nimport {\n    getTemplateFromBaseAst,\n} from './utils';\n\nimport {\n    clearCombineCache,\n} from './utils/combine-component-cache';\n\nconst genericPlugin = () => {\n    let platform = '';\n    return [\n        {\n            name: 'vite-plugin-pre-generics',\n            enforce: 'pre', // 需要在头部执行，才能获取到未被转义的原始文件\n            configResolved(config) {\n                platform = config.define['process.env.UNI_PLATFORM'].replace(/\\\"/g, '')\n            },\n            transform(code, id) {\n                // 可以拿到最初始的code，并且没有经过其他加工\n                const errors = [];\n                if (\n                    TEST_IS_PURE_VUE.test(id) &&\n                    code.indexOf(GENERIC_SLOT_KEY) !== -1\n                ) {\n                    // 是VUE组件且code中包含了generic才处理\n\n                    const codeObj = new MagicString(code);\n                    const ast = parseVue(code, errors);\n                    const templateAst = getTemplateFromBaseAst(ast);\n\n                    // 处理父组件的 generic 标识\n                    // 父: <child generic :index=\"index\" :name=\"'maxi'+val\" /> => <child u-i=\"generic-common-id\" :index=\"index\" :name=\"'maxi'+val\" />\n                    rewriteFcompGenericSym(templateAst, codeObj);\n\n                    // 处理组合组件的 generic \n                    // 组合：<ceshiGenetic generic:child=\"ceshiGeneticCom\">  => <ceshiGenetic u-i=\"generic-unq-id\">\n                    rewriteCcompGeneric(id, templateAst, codeObj)\n                    return {\n                        code: codeObj.toString(),\n                    };\n                }\n            },\n        },\n        {\n            name: 'vite-plugin-end-generics',\n            enforce: 'post', // 需要在尾部执行，才能拿到完整的文件列表\n            generateBundle(outputOptions, bundle, isWrite) {\n                // purpose\n                // 组合：<ceshiGenetic generic:child=\"ceshiGeneticCom\" generic:after=\"ceshiGeneticCom\"></ceshiGenetic>\n                //  删掉添加的 comp\n                //  添加 generic\n                // 父：<child generic :index=\"index\" :name=\"'maxi'+val\" /><after generic/>\n                //  添加json属性\n                //  添加generic\n                \n                // 清理genric的组件，组合成最终输出的要求\n                // TODO 在post的transform中修改？\n                cleanComponent(this, bundle, platform)\n                \n                // 删除本次构建存储的genric组件map\n                clearCombineCache();\n            },\n        },\n    ];\n};\n\nexport default genericPlugin;\n"],"names":["uuidv4","MagicString","parseVue"],"mappings":"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"}